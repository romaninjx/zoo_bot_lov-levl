мягко скажу, ФИГНЯ, ПЕРЕДЕЛЫВАЙ!!! нужно доробатывать и оптимизировать код... работает но криво.
